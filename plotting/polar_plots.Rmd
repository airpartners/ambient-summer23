---
title: "Polar Plots"
date: "2023-07-17"
output: html_document
---

This file generates PM1, PM2.5, and PM10 polar plots on a map showing to each sensor's location and the corresponding pollution readings

## INITIAL SETTINGS

```{r setup, include=FALSE}
# Check and install required packages if necessary
packages <- c(
  "openair",     # Package for analyzing air pollution data
  "openairmaps",  # Package for accessing open air pollution data
  "leaflet",
  "dplyr"
)
install.packages(packages[!sapply(packages, requireNamespace, quietly = TRUE)])

# Load required packages for data manipulation and analysis
invisible(sapply(packages, library, character.only = TRUE))

# Set options
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

# Suppress Warnings (This is a me thing, comment this session out to see the conflicting functions)
suppressPackageStartupMessages(library(maps))
```

## DATA LOADING AND CLEANING

```{r}
# Load data frame
load("../data/graphableData.RData")

# Calculate the average of each PM
averagePM1 <- mean(mod_met$pm1)
averagePM25 <- mean(mod_met$pm25)
averagePM10 <- mean(mod_met$pm10)

# Set the threshold for significant difference
threshold <- 2

# Filter out rows where the column value is significantly bigger than the average
mod_met_filtered <- mod_met[mod_met$pm1 <= averagePM1 * threshold, ]
mod_met_filtered <- mod_met[mod_met$pm25 <= averagePM25 * threshold, ]
mod_met_filtered <- mod_met[mod_met$pm10 <= averagePM10 * threshold, ]

# Filter the data to include only the desired time range
start_date <- as.Date("2022-07-01")
end_date <- as.Date("2023-02-28")
mod_met_filtered <- mod_met[mod_met$date >= start_date & mod_met$date <= end_date, ]
```

## POLAR PLOTTING

### Plotting Only PM1

```{r}
polarMap(
  mod_met_filtered,
  pollutant = c("pm1"),
  latitude = "lat",
  longitude = "lon",
  limits = c(0, 5),
  key = TRUE,
  provider = "OpenStreetMap")
```

### Plotting Only PM2.5

```{r}
polarMap(
  mod_met_filtered,
  pollutant = c("pm25"),
  latitude = "lat",
  longitude = "lon",
  limits = c(0, 12),
  key = TRUE,
  provider = "OpenStreetMap")
```

### Plotting Only PM10

```{r}
polarMap(
  mod_met_filtered,
  pollutant = c("pm10"),
  latitude = "lat",
  longitude = "lon",
  limits = c(5, 35),
  key = TRUE,
  provider = "OpenStreetMap")
```

### Plotting all PMs Polar Plots

Create a map with the average polar plots w/ of each pollution values (PM1, PM2.5, PM10) over certain periods of time (all time, monthly, daily, *hourly*)

```{r}
polarMap(
  mod_met_filtered,
  pollutant = c("pm1", "pm25", "pm10"),
  latitude = "lat",
  longitude = "lon",
  normalize = TRUE,
  key = TRUE,
  provider = "OpenStreetMap")
```
